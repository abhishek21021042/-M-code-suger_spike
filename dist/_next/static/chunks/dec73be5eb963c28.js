(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,81093,e=>{"use strict";var t,s,n,a,i,o,r,l,c,d,u,h,m,f,x,g,p,b,N,y,w,v,E,C,j=e.i(36768),O=e.i(13869),_=e.i(3624),I=e.i(17318),S=e.i(71885),T=e.i(76966);e.i(6655),(t=m||(m={})).STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object",(s=f||(f={})).LANGUAGE_UNSPECIFIED="language_unspecified",s.PYTHON="python",(n=x||(x={})).OUTCOME_UNSPECIFIED="outcome_unspecified",n.OUTCOME_OK="outcome_ok",n.OUTCOME_FAILED="outcome_failed",n.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";let A=["user","model","function","system"];(a=g||(g={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",a.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",a.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",a.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",a.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",a.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(i=p||(p={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",(o=b||(b={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",o.NEGLIGIBLE="NEGLIGIBLE",o.LOW="LOW",o.MEDIUM="MEDIUM",o.HIGH="HIGH",(r=N||(N={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER",(l=y||(y={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",l.STOP="STOP",l.MAX_TOKENS="MAX_TOKENS",l.SAFETY="SAFETY",l.RECITATION="RECITATION",l.LANGUAGE="LANGUAGE",l.BLOCKLIST="BLOCKLIST",l.PROHIBITED_CONTENT="PROHIBITED_CONTENT",l.SPII="SPII",l.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",l.OTHER="OTHER",(c=w||(w={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",c.RETRIEVAL_QUERY="RETRIEVAL_QUERY",c.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",c.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",c.CLASSIFICATION="CLASSIFICATION",c.CLUSTERING="CLUSTERING",(d=v||(v={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",d.AUTO="AUTO",d.ANY="ANY",d.NONE="NONE",(u=E||(E={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",u.MODE_DYNAMIC="MODE_DYNAMIC";class R extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class k extends R{constructor(e,t){super(e),this.response=t}}class M extends R{constructor(e,t,s,n){super(e),this.status=t,this.statusText=s,this.errorDetails=n}}class L extends R{}class D extends R{}(h=C||(C={})).GENERATE_CONTENT="generateContent",h.STREAM_GENERATE_CONTENT="streamGenerateContent",h.COUNT_TOKENS="countTokens",h.EMBED_CONTENT="embedContent",h.BATCH_EMBED_CONTENTS="batchEmbedContents";class P{constructor(e,t,s,n,a){this.model=e,this.task=t,this.apiKey=s,this.stream=n,this.requestOptions=a}toString(){var e,t;let s=(null==(e=this.requestOptions)?void 0:e.apiVersion)||"v1beta",n=(null==(t=this.requestOptions)?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",a=`${n}/${s}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}async function F(e){var t,s;let n,a=new Headers;a.append("Content-Type","application/json"),a.append("x-goog-api-client",(s=e.requestOptions,n=[],(null==s?void 0:s.apiClient)&&n.push(s.apiClient),n.push("genai-js/0.24.1"),n.join(" "))),a.append("x-goog-api-key",e.apiKey);let i=null==(t=e.requestOptions)?void 0:t.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(e){throw new L(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${e.message}`)}for(let[e,t]of i.entries()){if("x-goog-api-key"===e)throw new L(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new L(`Header name ${e} can only be set using the apiClient field`);a.append(e,t)}}return a}async function U(e,t,s,n,a,i){let o=new P(e,t,s,n,i);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let s=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>s.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{s.abort()}),t.signal=s.signal}return t}(i)),{method:"POST",headers:await F(o),body:a})}}async function H(e,t,s,n,a,i={},o=fetch){let{url:r,fetchOptions:l}=await U(e,t,s,n,a,i);return G(r,l,o)}async function G(e,t,s=fetch){let n;try{n=await s(e,t)}catch(s){var a=s,i=e;let t=a;throw"AbortError"===t.name?(t=new D(`Request aborted when fetching ${i.toString()}: ${a.message}`)).stack=a.stack:a instanceof M||a instanceof L||((t=new R(`Error fetching from ${i.toString()}: ${a.message}`)).stack=a.stack),t}return n.ok||await $(n,e),n}async function $(e,t){let s,n="";try{let t=await e.json();n=t.error.message,t.error.details&&(n+=` ${JSON.stringify(t.error.details)}`,s=t.error.details)}catch(e){}throw new M(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${n}`,e.status,e.statusText,s)}function B(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),q(e.candidates[0]))throw new k(`${V(e)}`,e);return function(e){var t,s,n,a;let i=[];if(null==(s=null==(t=e.candidates)?void 0:t[0].content)?void 0:s.parts)for(let t of null==(a=null==(n=e.candidates)?void 0:n[0].content)?void 0:a.parts)t.text&&i.push(t.text),t.executableCode&&i.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&i.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}(e)}if(e.promptFeedback)throw new k(`Text not available. ${V(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),q(e.candidates[0]))throw new k(`${V(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Y(e)[0]}if(e.promptFeedback)throw new k(`Function call not available. ${V(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),q(e.candidates[0]))throw new k(`${V(e)}`,e);return Y(e)}if(e.promptFeedback)throw new k(`Function call not available. ${V(e)}`,e)},e}function Y(e){var t,s,n,a;let i=[];if(null==(s=null==(t=e.candidates)?void 0:t[0].content)?void 0:s.parts)for(let t of null==(a=null==(n=e.candidates)?void 0:n[0].content)?void 0:a.parts)t.functionCall&&i.push(t.functionCall);return i.length>0?i:void 0}let K=[y.RECITATION,y.SAFETY,y.LANGUAGE];function q(e){return!!e.finishReason&&K.includes(e.finishReason)}function V(e){var t,s,n;let a="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)a+="Response was blocked",(null==(t=e.promptFeedback)?void 0:t.blockReason)&&(a+=` due to ${e.promptFeedback.blockReason}`),(null==(s=e.promptFeedback)?void 0:s.blockReasonMessage)&&(a+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null==(n=e.candidates)?void 0:n[0]){let t=e.candidates[0];q(t)&&(a+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(a+=`: ${t.finishMessage}`))}return a}function J(e){return this instanceof J?(this.v=e,this):new J(e)}"function"==typeof SuppressedError&&SuppressedError;let z=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function W(e){let t=[],s=e.getReader();for(;;){let{done:e,value:n}=await s.read();if(e)return B(function(e){let t=e[e.length-1],s={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates){let e=0;for(let n of t.candidates)if(s.candidates||(s.candidates=[]),s.candidates[e]||(s.candidates[e]={index:e}),s.candidates[e].citationMetadata=n.citationMetadata,s.candidates[e].groundingMetadata=n.groundingMetadata,s.candidates[e].finishReason=n.finishReason,s.candidates[e].finishMessage=n.finishMessage,s.candidates[e].safetyRatings=n.safetyRatings,n.content&&n.content.parts){s.candidates[e].content||(s.candidates[e].content={role:n.content.role||"user",parts:[]});let t={};for(let a of n.content.parts)a.text&&(t.text=a.text),a.functionCall&&(t.functionCall=a.functionCall),a.executableCode&&(t.executableCode=a.executableCode),a.codeExecutionResult&&(t.codeExecutionResult=a.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),s.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(s.usageMetadata=t.usageMetadata)}return s}(t));t.push(n)}}async function X(e,t,s,n){return function(e){let t,[s,n]=(t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})).getReader(),new ReadableStream({start(e){let s="";return function n(){return t.read().then(({value:t,done:a})=>{let i;if(a)return s.trim()?void e.error(new R("Failed to parse stream")):void e.close();let o=(s+=t).match(z);for(;o;){try{i=JSON.parse(o[1])}catch(t){e.error(new R(`Error parsing JSON response: "${o[1]}"`));return}e.enqueue(i),o=(s=s.substring(o[0].length)).match(z)}return n()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new D("Request aborted when reading from the stream"):new R("Error reading from the stream")})}()}})).tee();return{stream:function(e){return function(e,t,s){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,a=s.apply(e,t||[]),i=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(e){a[e]&&(n[e]=function(t){return new Promise(function(s,n){i.push([e,t,s,n])>1||r(e,t)})})}function r(e,t){try{var s;(s=a[e](t)).value instanceof J?Promise.resolve(s.value.v).then(l,c):d(i[0][2],s)}catch(e){d(i[0][3],e)}}function l(e){r("next",e)}function c(e){r("throw",e)}function d(e,t){e(t),i.shift(),i.length&&r(i[0][0],i[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:s}=yield J(t.read());if(s)break;yield yield J(B(e))}})}(s),response:W(n)}}(await H(t,C.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(s),n))}async function Z(e,t,s,n){let a=await H(t,C.GENERATE_CONTENT,e,!1,JSON.stringify(s),n);return{response:B(await a.json())}}function Q(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)if(!e.role)return{role:"system",parts:e.parts};else return e}}function ee(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let s of e)"string"==typeof s?t.push({text:s}):t.push(s);var s=t;let n={role:"user",parts:[]},a={role:"function",parts:[]},i=!1,o=!1;for(let e of s)"functionResponse"in e?(a.parts.push(e),o=!0):(n.parts.push(e),i=!0);if(i&&o)throw new R("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!o)throw new R("No content is provided for sending chat message.");return i?n:a}function et(e){let t;return t=e.contents?e:{contents:[ee(e)]},e.systemInstruction&&(t.systemInstruction=Q(e.systemInstruction)),t}let es=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],en={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function ea(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;let s=null==(t=e.candidates[0])?void 0:t.content;if(void 0===s||void 0===s.parts||0===s.parts.length)return!1;for(let e of s.parts)if(void 0===e||0===Object.keys(e).length||void 0!==e.text&&""===e.text)return!1;return!0}let ei="SILENT_ERROR";class eo{constructor(e,t,s,n={}){this.model=t,this.params=s,this._requestOptions=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==s?void 0:s.history)&&(!function(e){let t=!1;for(let s of e){let{role:e,parts:n}=s;if(!t&&"user"!==e)throw new R(`First content should be with role 'user', got ${e}`);if(!A.includes(e))throw new R(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(A)}`);if(!Array.isArray(n))throw new R("Content should have 'parts' property with an array of Parts");if(0===n.length)throw new R("Each Content should have at least one part");let a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of n)for(let t of es)t in e&&(a[t]+=1);let i=en[e];for(let t of es)if(!i.includes(t)&&a[t]>0)throw new R(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(s.history),this._history=s.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var s,n,a,i,o,r;let l;await this._sendPromise;let c=ee(e),d={safetySettings:null==(s=this.params)?void 0:s.safetySettings,generationConfig:null==(n=this.params)?void 0:n.generationConfig,tools:null==(a=this.params)?void 0:a.tools,toolConfig:null==(i=this.params)?void 0:i.toolConfig,systemInstruction:null==(o=this.params)?void 0:o.systemInstruction,cachedContent:null==(r=this.params)?void 0:r.cachedContent,contents:[...this._history,c]},u=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>Z(this._apiKey,this.model,d,u)).then(e=>{var t;if(ea(e.response)){this._history.push(c);let s=Object.assign({parts:[],role:"model"},null==(t=e.response.candidates)?void 0:t[0].content);this._history.push(s)}else{let t=V(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}l=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,l}async sendMessageStream(e,t={}){var s,n,a,i,o,r;await this._sendPromise;let l=ee(e),c={safetySettings:null==(s=this.params)?void 0:s.safetySettings,generationConfig:null==(n=this.params)?void 0:n.generationConfig,tools:null==(a=this.params)?void 0:a.tools,toolConfig:null==(i=this.params)?void 0:i.toolConfig,systemInstruction:null==(o=this.params)?void 0:o.systemInstruction,cachedContent:null==(r=this.params)?void 0:r.cachedContent,contents:[...this._history,l]},d=Object.assign(Object.assign({},this._requestOptions),t),u=X(this._apiKey,this.model,c,d);return this._sendPromise=this._sendPromise.then(()=>u).catch(e=>{throw Error(ei)}).then(e=>e.response).then(e=>{if(ea(e)){this._history.push(l);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=V(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==ei&&console.error(e)}),u}}async function er(e,t,s,n){return(await H(t,C.COUNT_TOKENS,e,!1,JSON.stringify(s),n)).json()}async function el(e,t,s,n){return(await H(t,C.EMBED_CONTENT,e,!1,JSON.stringify(s),n)).json()}async function ec(e,t,s,n){let a=s.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await H(t,C.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:a}),n)).json()}class ed{constructor(e,t,s={}){this.apiKey=e,this._requestOptions=s,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=Q(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var s;let n=et(e),a=Object.assign(Object.assign({},this._requestOptions),t);return Z(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(s=this.cachedContent)?void 0:s.name},n),a)}async generateContentStream(e,t={}){var s;let n=et(e),a=Object.assign(Object.assign({},this._requestOptions),t);return X(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(s=this.cachedContent)?void 0:s.name},n),a)}startChat(e){var t;return new eo(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(t=this.cachedContent)?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let s=function(e,t){var s;let n={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null==(s=null==t?void 0:t.cachedContent)?void 0:s.name,contents:[]},a=null!=e.generateContentRequest;if(e.contents){if(a)throw new L("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=e.contents}else if(a)n=Object.assign(Object.assign({},n),e.generateContentRequest);else{let t=ee(e);n.contents=[t]}return{generateContentRequest:n}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),n=Object.assign(Object.assign({},this._requestOptions),t);return er(this.apiKey,this.model,s,n)}async embedContent(e,t={}){let s="string"==typeof e||Array.isArray(e)?{content:ee(e)}:e,n=Object.assign(Object.assign({},this._requestOptions),t);return el(this.apiKey,this.model,s,n)}async batchEmbedContents(e,t={}){let s=Object.assign(Object.assign({},this._requestOptions),t);return ec(this.apiKey,this.model,e,s)}}class eu{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new R("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new ed(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,s){if(!e.name)throw new L("Cached content must contain a `name` field.");if(!e.model)throw new L("Cached content must contain a `model` field.");for(let s of["model","systemInstruction"])if((null==t?void 0:t[s])&&e[s]&&(null==t?void 0:t[s])!==e[s]){if("model"===s&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new L(`Different value for "${s}" specified in modelParams (${t[s]}) and cachedContent (${e[s]})`)}let n=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new ed(this.apiKey,n,s)}}let eh=new eu("AIzaSyDWAVWhV1obb7RmLZIs0-Lz_CMO7CjUJ5c");async function em(e){try{let t=eh.getGenerativeModel({model:"gemini-1.5-flash"}),s=`
            Analyze this voice log describing a meal. 
            Extract the food items and estimate the sugar content for each item in grams.
            Return ONLY a valid JSON object with this structure:
            {
                "items": [
                    { "name": "Food Name", "sugar": 10, "emoji": "ðŸŽ" }
                ],
                "totalSugar": 10,
                "insight": "Short nutritional insight about this meal (max 10 words)"
            }
            If no food is detected, return { "items": [], "totalSugar": 0, "insight": "No food detected" }.
        `,n=await t.generateContent({contents:[{role:"user",parts:[{text:s},{inlineData:{mimeType:"audio/webm",data:e}}]}],generationConfig:{responseMimeType:"application/json"}}),a=(await n.response).text().replace(/```json/g,"").replace(/```/g,"").trim();return JSON.parse(a)}catch(e){throw console.error("Error analyzing voice log:",e),Error("Failed to analyze voice log")}}function ef({onClose:e}){let[t,s]=(0,T.useState)(!1),[n,a]=(0,T.useState)(!1),[i,o]=(0,T.useState)(null),r=(0,T.useRef)(null),l=(0,T.useRef)([]),c=(0,I.useOnboardingStore)(e=>e.proposeLog),d=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});r.current=new MediaRecorder(e),l.current=[],r.current.ondataavailable=e=>{l.current.push(e.data)},r.current.onstop=async()=>{let e=new Blob(l.current,{type:"audio/webm"}),t=new FileReader;t.readAsDataURL(e),t.onloadend=async()=>{let e=t.result.split(",")[1];a(!0);try{let t=await em(e);o(t)}catch(e){console.error(e)}finally{a(!1)}}},r.current.start(),s(!0)}catch(e){console.error("Error accessing microphone:",e)}};return(0,j.jsx)("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center p-4 bg-black/60 backdrop-blur-sm",children:(0,j.jsx)(O.motion.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},className:"w-full max-w-sm",children:(0,j.jsxs)(S.default,{className:"p-6 flex flex-col items-center gap-6 relative overflow-hidden",children:[(0,j.jsx)("button",{onClick:e,className:"absolute top-4 right-4 text-white/40 hover:text-white",children:(0,j.jsx)("span",{className:"material-icons",children:"close"})}),i?(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("div",{className:"w-full",children:[(0,j.jsxs)("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[(0,j.jsx)("span",{className:"text-brand-teal",children:"âœ¨"})," Analysis Complete"]}),(0,j.jsx)("div",{className:"space-y-3 mb-6 max-h-[40vh] overflow-y-auto",children:i.items.map((e,t)=>(0,j.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/5",children:[(0,j.jsxs)("div",{className:"flex items-center gap-3",children:[(0,j.jsx)("span",{className:"text-2xl",children:e.emoji}),(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{className:"font-bold text-sm",children:e.name}),(0,j.jsxs)("p",{className:"text-xs text-white/50",children:[e.sugar,"g sugar"]})]})]}),(0,j.jsx)("div",{className:"w-4 h-4 rounded-full border-2 border-brand-teal flex items-center justify-center",children:(0,j.jsx)("div",{className:"w-2 h-2 bg-brand-teal rounded-full"})})]},t))}),(0,j.jsx)("div",{className:"p-3 rounded-xl bg-brand-teal/10 border border-brand-teal/20 mb-6",children:(0,j.jsxs)("p",{className:"text-xs text-brand-teal italic",children:['"',i.insight,'"']})}),(0,j.jsx)("button",{onClick:()=>{i&&i.items&&(i.items.forEach(e=>{c({emoji:e.emoji||"ðŸ½ï¸",name:e.name,xp:10,sugar:e.sugar||0,source:"voice"})}),e())},className:"w-full py-3 rounded-xl bg-brand-teal text-bg-base font-bold shadow-lg shadow-brand-teal/20 hover:scale-[1.02] active:scale-95 transition-all",children:"Log Meals"})]})}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:"text-center",children:[(0,j.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Voice Log"}),(0,j.jsx)("p",{className:"text-sm text-white/50",children:t?"Listening...":n?"Analyzing...":"Tap to start recording"})]}),(0,j.jsxs)("div",{className:"relative",children:[t&&(0,j.jsx)("div",{className:"absolute inset-0 bg-brand-teal/20 rounded-full animate-ping"}),(0,j.jsx)("button",{onClick:t?()=>{r.current&&t&&(r.current.stop(),s(!1))}:d,disabled:n,className:`w-20 h-20 rounded-full flex items-center justify-center transition-all ${t?"bg-red-500 shadow-[0_0_30px_rgba(239,68,68,0.4)]":n?"bg-white/10 animate-pulse":"bg-brand-teal shadow-[0_0_30px_rgba(78,205,196,0.3)] hover:scale-105"}`,children:(0,j.jsx)("span",{className:"material-icons text-3xl text-white",children:t?"stop":"mic"})})]}),n&&(0,j.jsx)("p",{className:"text-xs text-brand-teal animate-pulse",children:"Consulting with Gemini AI..."})]})]})})})}let ex=new eu("AIzaSyDWAVWhV1obb7RmLZIs0-Lz_CMO7CjUJ5c");async function eg(e){try{let t=ex.getGenerativeModel({model:"gemini-1.5-flash"}),s=e.split(",")[1],n=`
            Analyze this image of food and identify the primary item. 
            Provide the following information in a strict JSON format:
            {
                "name": "Common name of the food",
                "emoji": "A single relevant emoji",
                "sugar": "Estimated grams of sugar per typical serving (number only)",
                "reasoning": "A very brief explanation of why this is a sugar/glucose spike concern (1 sentence)"
            }
            Only return the JSON. No other text.
        `,a=await t.generateContent([n,{inlineData:{data:s,mimeType:"image/jpeg"}}]),i=(await a.response).text().match(/\{[\s\S]*\}/);if(!i)throw Error("Invalid AI response");let o=JSON.parse(i[0]);return{success:!0,data:{name:o.name,emoji:o.emoji,xp:5,sugarAmount:parseInt(o.sugar)||15,reasoning:o.reasoning}}}catch(e){return console.error("AI Analysis Error:",e),{success:!1,error:"Failed to analyze food. Maybe its not clear?"}}}function ep({onClose:e}){let[t,s]=(0,T.useState)(null),[n,a]=(0,T.useState)(null),[i,o]=(0,T.useState)(!1),[r,l]=(0,T.useState)(null),[c,d]=(0,T.useState)(null),u=(0,T.useRef)(null),h=(0,I.useOnboardingStore)(e=>e.proposeLog);(0,T.useEffect)(()=>((async function(){try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});s(e),u.current&&(u.current.srcObject=e)}catch(e){console.error("Camera access error:",e)}})(),()=>{t?.getTracks().forEach(e=>e.stop())}),[]);let m=async e=>{o(!0),d(null);let t=await eg(e);o(!1),t.success?l(t.data):d(t.error||"Failed to detect food.")};return(0,j.jsx)("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black",children:(0,j.jsxs)("div",{className:"relative w-full h-full max-w-md mx-auto flex flex-col",children:[(0,j.jsxs)("div",{className:"relative flex-1 bg-black overflow-hidden flex items-center justify-center",children:[n?(0,j.jsx)("img",{src:n,className:"w-full h-full object-cover"}):(0,j.jsx)("video",{ref:u,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,j.jsx)(_.AnimatePresence,{children:i&&(0,j.jsxs)(O.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-brand-teal/20 backdrop-blur-sm flex flex-col items-center justify-center",children:[(0,j.jsx)(O.motion.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-12 h-12 border-4 border-white/20 border-t-white rounded-full mb-4"}),(0,j.jsx)("p",{className:"text-white font-black italic tracking-widest",children:"AI ANALYZING..."})]})})]}),(0,j.jsxs)("div",{className:"absolute top-6 left-6 right-6 flex justify-between",children:[(0,j.jsx)("button",{onClick:e,className:"w-10 h-10 rounded-full bg-black/40 flex items-center justify-center text-white backdrop-blur-md",children:(0,j.jsx)("span",{className:"material-icons",children:"close"})}),(0,j.jsxs)("div",{className:"px-4 py-2 rounded-full bg-black/40 text-white text-xs font-bold backdrop-blur-md flex items-center gap-2",children:[(0,j.jsx)("span",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),"LIVE VISION"]})]}),(0,j.jsx)("div",{className:"p-10 bg-gradient-to-t from-black to-transparent flex flex-col items-center gap-6",children:n?r?(0,j.jsx)(O.motion.div,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},className:"w-full",children:(0,j.jsxs)(S.default,{className:"p-6 border-brand-teal/30 bg-white/5",children:[(0,j.jsxs)("div",{className:"flex items-center gap-4 mb-3",children:[(0,j.jsx)("span",{className:"text-4xl",children:r.emoji}),(0,j.jsxs)("div",{children:[(0,j.jsxs)("h4",{className:"text-white font-bold text-lg",children:["Detected: ",r.name]}),(0,j.jsxs)("p",{className:"text-brand-teal text-xs font-bold uppercase tracking-wider",children:["Estimated ",r.sugarAmount,"g Sugar"]})]})]}),(0,j.jsx)("p",{className:"text-[10px] text-white/40 italic leading-relaxed mb-4 border-l-2 border-brand-teal/20 pl-3",children:r.reasoning}),(0,j.jsxs)("div",{className:"flex gap-3",children:[(0,j.jsx)("button",{onClick:()=>{a(null),l(null)},className:"flex-1 py-3 rounded-xl bg-white/10 text-white font-bold text-sm",children:"Retake"}),(0,j.jsx)("button",{onClick:()=>{r&&(h({emoji:r.emoji,name:r.name,xp:r.xp||20,sugar:r.sugarAmount||0,source:"photo"}),e())},className:"flex-2 py-3 px-8 rounded-xl bg-brand-teal text-bg-base font-black text-sm uppercase tracking-wider",children:"Log Item"})]})]})}):c?(0,j.jsxs)("div",{className:"w-full text-center",children:[(0,j.jsx)("p",{className:"text-brand-coral text-xs font-bold mb-4",children:c}),(0,j.jsx)("button",{onClick:()=>{a(null),d(null)},className:"px-6 py-2 rounded-xl bg-white/10 text-white font-bold text-xs",children:"Try Again"})]}):(0,j.jsx)("p",{className:"text-white/40 italic",children:"Processing Vision..."}):(0,j.jsx)("button",{onClick:()=>{if(!u.current)return;let e=document.createElement("canvas");e.width=u.current.videoWidth,e.height=u.current.videoHeight;let s=e.getContext("2d");s?.drawImage(u.current,0,0);let n=e.toDataURL("image/jpeg",.8);a(n),t?.getTracks().forEach(e=>e.stop()),m(n)},className:"w-20 h-20 rounded-full border-4 border-white flex items-center justify-center p-1",children:(0,j.jsx)("div",{className:"w-full h-full bg-white rounded-full active:scale-90 transition-transform"})})})]})})}function eb({onClose:e}){let{logs:t,level:s,streak:n}=(0,I.useOnboardingStore)();return(0,j.jsx)("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-6 bg-black/80 backdrop-blur-md",children:(0,j.jsx)(O.motion.div,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},className:"w-full max-w-sm",children:(0,j.jsxs)(S.default,{className:"p-8 border-brand-teal/30 shadow-[0_0_50px_rgba(45,212,191,0.2)] bg-[var(--bg-neu-dark)]",children:[(0,j.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h2",{className:"text-2xl font-black text-white italic",children:"WEEKLY REPORT"}),(0,j.jsx)("p",{className:"text-brand-teal text-[10px] font-bold tracking-widest uppercase",children:"Performance Summary"})]}),(0,j.jsx)("button",{onClick:e,className:"text-white/20 hover:text-white",children:(0,j.jsx)("span",{className:"material-icons",children:"close"})})]}),(0,j.jsxs)("div",{className:"space-y-6",children:[(0,j.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,j.jsxs)("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5",children:[(0,j.jsx)("p",{className:"text-[9px] text-white/40 uppercase font-bold mb-1",children:"Total Logs"}),(0,j.jsx)("p",{className:"text-xl font-black text-white",children:t.length})]}),(0,j.jsxs)("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5",children:[(0,j.jsx)("p",{className:"text-[9px] text-white/40 uppercase font-bold mb-1",children:"Avg Spike"}),(0,j.jsx)("p",{className:"text-xl font-black text-brand-coral",children:"Moderate"})]})]}),(0,j.jsx)("div",{className:"p-4 bg-brand-teal/5 rounded-2xl border border-brand-teal/10",children:(0,j.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,j.jsx)("span",{className:"text-2xl",children:"ðŸ†"}),(0,j.jsxs)("div",{children:[(0,j.jsx)("h4",{className:"text-white font-bold text-sm text-brand-teal",children:"Top Performer"}),(0,j.jsxs)("p",{className:"text-[10px] text-white/40 italic",children:["You reached Level ",s," this week!"]})]})]})}),(0,j.jsx)("p",{className:"text-center text-xs text-white/60 italic leading-relaxed px-4",children:'"One bad log doesn\'t break a streak, but data mindfulness builds a legacy."'})]}),(0,j.jsx)("button",{onClick:()=>window.print(),className:"w-full mt-8 py-3 rounded-xl bg-brand-teal text-bg-base font-black uppercase tracking-widest text-sm shadow-lg shadow-brand-teal/20",children:"Download PDF"})]})})})}function eN({hideXPBar:e=!1}){let{xp:t,streak:s,level:n,setOverlayActive:a}=(0,I.useOnboardingStore)(),[i,o]=(0,T.useState)(!1),[r,l]=(0,T.useState)(!1),[c,d]=(0,T.useState)(!1),[u,h]=(0,T.useState)(!1),m=s>7?7:2*(s>3),f=s<=3?4:s<=7?8:null;return(0,j.jsxs)(O.motion.div,{initial:{y:-30,opacity:0},animate:{y:0,opacity:1},transition:{duration:.6,ease:[.22,1,.36,1]},className:"w-full flex flex-col gap-5 relative",children:[(0,j.jsxs)(_.AnimatePresence,{children:[i&&(0,j.jsx)(ef,{onClose:()=>{o(!1),a(!1)}}),r&&(0,j.jsx)(ep,{onClose:()=>{l(!1),a(!1)}}),c&&(0,j.jsx)(eb,{onClose:()=>d(!1)}),u&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(O.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>h(!1),className:"fixed inset-0 z-[100] bg-black/40 backdrop-blur-[2px]"}),(0,j.jsxs)(O.motion.div,{initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},className:"absolute top-12 right-0 z-[110] w-56 p-4 rounded-2xl bg-[#1e1e1e] border border-orange-500/30 shadow-[0_0_30px_rgba(249,115,22,0.15)]",children:[(0,j.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,j.jsx)("div",{className:"w-10 h-10 rounded-full bg-orange-500/20 flex items-center justify-center text-xl",children:"ðŸ”¥"}),(0,j.jsxs)("div",{children:[(0,j.jsx)("h4",{className:"text-white font-black text-sm uppercase italic tracking-tight",children:"Streak Status"}),(0,j.jsxs)("p",{className:"text-[10px] text-orange-400 font-bold uppercase tracking-widest",children:[s," Day Streak"]})]})]}),(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsxs)("div",{className:"p-2 rounded-xl bg-white/[0.03] border border-white/5 flex items-center justify-between font-bold",children:[(0,j.jsx)("span",{className:"text-[10px] text-white/40 uppercase",children:"Current Bonus"}),(0,j.jsxs)("span",{className:"text-brand-teal text-xs",children:["+",m," XP / Log"]})]}),f&&(0,j.jsxs)("div",{className:"p-2 rounded-xl bg-orange-500/5 border border-orange-500/10 flex flex-col gap-1",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between text-[10px] font-black uppercase tracking-tight",children:[(0,j.jsx)("span",{className:"text-white/40",children:"Next Milestone"}),(0,j.jsxs)("span",{className:"text-orange-400",children:[f," Days"]})]}),(0,j.jsx)("div",{className:"h-1 w-full bg-white/10 rounded-full overflow-hidden",children:(0,j.jsx)("div",{className:"h-full bg-orange-500 rounded-full",style:{width:`${s/f*100}%`}})}),(0,j.jsxs)("p",{className:"text-[9px] text-white/30 italic",children:["Reach ",f," days for increased XP bonus!"]})]})]})]})]})]}),(0,j.jsxs)("div",{className:"flex justify-between items-start",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h1",{className:"text-xl font-extrabold tracking-tight",style:{color:"var(--foreground)"},children:"Hey, there! ðŸ‘‹"}),(0,j.jsxs)("p",{className:"text-[10px] uppercase font-bold tracking-[0.2em] text-white/35 mt-0.5",children:["Level ",n," Slayer"]})]}),(0,j.jsx)("div",{className:"flex items-center gap-2",children:(0,j.jsxs)("div",{onClick:()=>h(!u),className:"flex items-center gap-1.5 bg-gradient-to-r from-orange-500/10 to-amber-500/10 backdrop-blur-md px-3 py-1.5 rounded-full border border-orange-500/20 cursor-pointer active:scale-95 transition-all hover:bg-orange-500/20",children:[(0,j.jsx)("span",{className:"text-base",children:"ðŸ”¥"}),(0,j.jsx)("span",{className:"font-extrabold text-sm text-orange-400",children:s})]})})]}),(0,j.jsxs)("div",{className:"flex gap-2",children:[(0,j.jsxs)("button",{onClick:()=>{o(!0),a(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-2xl bg-gradient-to-r from-brand-teal to-brand-teal-light text-bg-base font-bold text-xs shadow-lg shadow-brand-teal/15 active:scale-[0.97] transition-transform relative overflow-hidden",children:[(0,j.jsx)("span",{className:"material-icons text-base",children:"mic"}),"Voice",(0,j.jsx)("span",{className:"absolute top-1 right-2 text-[7px] font-black uppercase bg-black/10 px-1 rounded-sm",children:"Beta"})]}),(0,j.jsxs)("button",{onClick:()=>{l(!0),a(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-2xl bg-white/[0.05] border border-white/[0.08] text-white/80 font-bold text-xs active:scale-[0.97] transition-transform hover:bg-white/[0.08] relative overflow-hidden",children:[(0,j.jsx)("span",{className:"material-icons text-base",children:"photo_camera"}),"Photo",(0,j.jsx)("span",{className:"absolute top-1 right-2 text-[7px] font-black uppercase text-brand-coral bg-brand-coral/10 px-1 rounded-sm border border-brand-coral/20",children:"Beta"})]}),(0,j.jsxs)("button",{onClick:()=>d(!0),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-2xl bg-brand-coral/10 border border-brand-coral/15 text-brand-coral font-bold text-xs active:scale-[0.97] transition-transform hover:bg-brand-coral/15",children:[(0,j.jsx)("span",{className:"material-icons text-base",children:"assessment"}),"Report"]})]}),!e&&(0,j.jsxs)(S.default,{className:"p-4 relative overflow-hidden bg-gradient-to-br from-brand-teal/10 to-transparent border-brand-teal/20",children:[(0,j.jsxs)("div",{className:"flex justify-between items-end mb-3 relative z-10",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{className:"text-[10px] font-bold text-white/40 uppercase tracking-widest mb-0.5",children:"Current Level"}),(0,j.jsxs)("div",{className:"text-3xl font-black italic tracking-tight text-white flex items-baseline gap-1",children:[(0,j.jsx)("span",{className:"text-lg opacity-50 not-italic font-bold",children:"LVL"}),n]})]}),(0,j.jsxs)("div",{className:"text-right",children:[(0,j.jsxs)("div",{className:"text-xs font-bold text-white/50 mb-0.5",children:[(0,j.jsx)("span",{className:"text-white",children:t})," ",(0,j.jsxs)("span",{className:"opacity-50",children:["/ ",500*n," XP"]})]}),(0,j.jsxs)("div",{className:"text-[10px] font-bold text-brand-teal italic",children:[500*n-t," XP to next"]})]})]}),(0,j.jsx)("div",{className:"h-2 w-full bg-black/20 rounded-full overflow-hidden relative z-10",children:(0,j.jsx)(O.motion.div,{initial:{width:0},animate:{width:`${Math.min(100,t%500/500*100)}%`},transition:{duration:1,ease:"easeOut"},className:"h-full bg-brand-teal rounded-full relative",children:(0,j.jsx)("div",{className:"absolute inset-0 bg-white/20",style:{animation:"shimmer 2s infinite linear"}})})})]})]})}e.s(["default",()=>eN],81093)}]);